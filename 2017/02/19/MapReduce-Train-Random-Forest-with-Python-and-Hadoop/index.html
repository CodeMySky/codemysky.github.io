<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>MapReduce: Train Random Forest with Python and Hadoop | CodeMySky&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Install Hortonworks SandboxHortonworks sandbox provides a nice playground for hadoop beginners to test their big data application.  Windows and Linux: Install Virtual Box MAC: Install VMWare Fusion In">
<meta property="og:type" content="article">
<meta property="og:title" content="MapReduce: Train Random Forest with Python and Hadoop">
<meta property="og:url" content="http://xiaohan.me/2017/02/19/MapReduce-Train-Random-Forest-with-Python-and-Hadoop/index.html">
<meta property="og:site_name" content="CodeMySky&#39;s Blog">
<meta property="og:description" content="Install Hortonworks SandboxHortonworks sandbox provides a nice playground for hadoop beginners to test their big data application.  Windows and Linux: Install Virtual Box MAC: Install VMWare Fusion In">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-02-19T20:02:41.572Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MapReduce: Train Random Forest with Python and Hadoop">
<meta name="twitter:description" content="Install Hortonworks SandboxHortonworks sandbox provides a nice playground for hadoop beginners to test their big data application.  Windows and Linux: Install Virtual Box MAC: Install VMWare Fusion In">
  
    <link rel="alternative" href="/atom.xml" title="CodeMySky&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/require-2.1.6,jquery-1.9.1.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="#" class="profilepic">
			<img src="/img/avatar.jpg" class="js-avatar" style="width: 100%;height: 100%;opacity: 1;">
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Sean Han</a></h1>
		</hgroup>

		
		<p class="header-subtitle">My heart is in BIG DATA</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>

				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
							<li><a href="/2016/01/07/About-Me/">About Me</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/CodeMySky" title="github">github</a>
					        
								<a class="mail" target="_blank" href="mailto:hanxiaobow@gmail.com" title="mail">mail</a>
					        
								<a class="linkedin" target="_blank" href="https://www.linkedin.com/in/codemysky" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>

				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/about-me/" style="font-size: 10px;">about-me</a> <a href="/tags/f-test/" style="font-size: 10px;">f-test</a> <a href="/tags/feature-extraction/" style="font-size: 10px;">feature-extraction</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/hortonworks/" style="font-size: 10px;">hortonworks</a> <a href="/tags/introduction/" style="font-size: 10px;">introduction</a> <a href="/tags/knn/" style="font-size: 10px;">knn</a> <a href="/tags/mapreduce/" style="font-size: 16.67px;">mapreduce</a> <a href="/tags/predicting-poker-hands/" style="font-size: 20px;">predicting-poker-hands</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/random-forest/" style="font-size: 13.33px;">random-forest</a> <a href="/tags/sklearn/" style="font-size: 16.67px;">sklearn</a> <a href="/tags/statistics/" style="font-size: 10px;">statistics</a> <a href="/tags/t-test/" style="font-size: 10px;">t-test</a> <a href="/tags/z-test/" style="font-size: 10px;">z-test</a>
					</div>
				</section>
				

				

				
			</div>
		</div>
	</header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Sean Han</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="/img/avatar.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Sean Han</h1>
			</hgroup>
			
			<p class="header-subtitle">My heart is in BIG DATA</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
					<li><a href="/2016/01/07/About-Me/">About Me</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/CodeMySky" title="github">github</a>
			        
						<a class="mail" target="_blank" href="mailto:hanxiaobow@gmail.com" title="mail">mail</a>
			        
						<a class="linkedin" target="_blank" href="https://www.linkedin.com/in/codemysky" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-MapReduce-Train-Random-Forest-with-Python-and-Hadoop" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/02/19/MapReduce-Train-Random-Forest-with-Python-and-Hadoop/" class="article-date">
  	<time datetime="2017-02-19T19:53:14.000Z" itemprop="datePublished">2017-02-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      MapReduce: Train Random Forest with Python and Hadoop
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Install-Hortonworks-Sandbox"><a href="#Install-Hortonworks-Sandbox" class="headerlink" title="Install Hortonworks Sandbox"></a>Install Hortonworks Sandbox</h2><p>Hortonworks sandbox provides a nice playground for hadoop beginners to test their big data application.</p>
<ul>
<li><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener">Windows and Linux: Install Virtual Box</a></li>
<li><a href="https://www.vmware.com/go/downloadfusion" target="_blank" rel="noopener">MAC: Install VMWare Fusion</a></li>
<li><a href="https://hortonworks.com/downloads/" target="_blank" rel="noopener">Install Hortonworks Sandbox</a></li>
<li><a href="http://hortonworks.com/hadoop-tutorial/learning-the-ropes-of-the-hortonworks-sandbox/" target="_blank" rel="noopener">Follow tutorial to setup environment and password</a></li>
<li>The python shipped with hortonworks is Python 2.6, which is really old.</li>
<li>Install Anaconda3 to upgrade python to Python 3.6 to default location /root/anaconda3</li>
<li><a href="https://www.continuum.io/downloads" target="_blank" rel="noopener">Anaconda</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash Anaconda3-XXX-Linux-x86_64.sh</span><br></pre></td></tr></table></figure>
<h2 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/root/anaconda3/bin/python</span></span><br><span class="line"><span class="comment"># Filename: forest_mapper.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecisionNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, depth = <span class="number">0</span>, max_depth = <span class="number">-1</span>)</span>:</span></span><br><span class="line">        self._left_child = <span class="keyword">None</span></span><br><span class="line">        self._right_child = <span class="keyword">None</span></span><br><span class="line">        self._depth = depth</span><br><span class="line">        self._max_depth = max_depth</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_divide</span><span class="params">(self, data_set, column, condition)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(condition, str):</span><br><span class="line">            part_a = data_set[data_set[column] == condition]</span><br><span class="line">            part_b = data_set[data_set[column] != condition]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            part_a = data_set[data_set[column] &gt;= condition]</span><br><span class="line">            part_b = data_set[data_set[column] &lt; condition]</span><br><span class="line">        <span class="keyword">return</span> part_a, part_b</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_entropy</span><span class="params">(self, labels)</span>:</span></span><br><span class="line">        counts = labels.value_counts()</span><br><span class="line">        total = sum(counts)</span><br><span class="line">        entropy = -counts.map(<span class="keyword">lambda</span> c: (c/total) * math.log2(c/total)).sum()</span><br><span class="line">        <span class="keyword">return</span> entropy</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_entropy_sum</span><span class="params">(self, set_a, set_b)</span>:</span></span><br><span class="line">        size_a = set_a.shape[<span class="number">0</span>]</span><br><span class="line">        size_b = set_b.shape[<span class="number">0</span>]</span><br><span class="line">        total = size_a + size_b</span><br><span class="line">        total_entropy = size_a / total * self._entropy(set_a) + size_b / total * self._entropy(set_b)</span><br><span class="line">        <span class="keyword">return</span> total_entropy</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_information_gain</span><span class="params">(self,data_set, column, condition)</span>:</span></span><br><span class="line">        set_a, set_b = self._divide(data_set, column, condition)</span><br><span class="line">        gain = self._entropy(data_set.iloc[:, <span class="number">-1</span>]) - self._entropy_sum(set_a.iloc[:,<span class="number">-1</span>], set_b.iloc[:,<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">return</span> gain</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fit</span><span class="params">(self, data_set, selected_features = None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> selected_features <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            columns = data_set.columns.values.tolist()</span><br><span class="line">            selected_features = columns[:<span class="number">-1</span>]</span><br><span class="line">        </span><br><span class="line">        best_gain = <span class="number">0</span></span><br><span class="line">        best_split_col = <span class="keyword">None</span></span><br><span class="line">        best_split_value = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> column_name <span class="keyword">in</span> selected_features:</span><br><span class="line">            current_column = data_set[column_name]</span><br><span class="line">            unique_values = current_column.unique().tolist()</span><br><span class="line">            <span class="keyword">for</span> value <span class="keyword">in</span> unique_values:</span><br><span class="line">                gain = self._information_gain(data_set, column_name, value)</span><br><span class="line">                <span class="keyword">if</span> gain &gt; best_gain:</span><br><span class="line">                    best_gain = gain</span><br><span class="line">                    best_split_col = column_name</span><br><span class="line">                    best_split_value = value</span><br><span class="line">                    </span><br><span class="line">        self._best_split_col = best_split_col</span><br><span class="line">        self._best_split_value = best_split_value</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> best_gain &gt; <span class="number">0</span> <span class="keyword">and</span> (self._max_depth == <span class="number">-1</span> <span class="keyword">or</span> self._depth &lt; self._max_depth):</span><br><span class="line">            set_a, set_b = self._divide(data_set, best_split_col, best_split_value)</span><br><span class="line">            self._left_child = DecisionNode(self._depth + <span class="number">1</span>, self._max_depth)</span><br><span class="line">            self._left_child.fit(set_a)</span><br><span class="line">            </span><br><span class="line">            self._right_child = DecisionNode(self._depth + <span class="number">1</span>, self._max_depth)</span><br><span class="line">            self._right_child.fit(set_b)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._leaf_value = data_set.iloc[:,<span class="number">-1</span>].unique()[<span class="number">0</span>]</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict_single</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self._left_child <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">and</span> self._right_child <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self._leaf_value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> isinstance(self._best_split_value, str):</span><br><span class="line">                go_left = record[self._best_split_col] == self._best_split_value</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                go_left = record[self._best_split_col] &gt;= self._best_split_value</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">if</span> go_left:</span><br><span class="line">                <span class="keyword">return</span> self._left_child.predict_single(record)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> self._right_child.predict_single(record)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, data_set)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> data_set.apply(self.predict_single, axis=<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        tree_str = <span class="string">'\t'</span> * self._depth + <span class="string">'&gt;'</span></span><br><span class="line">        <span class="keyword">if</span> self._left_child == <span class="keyword">None</span> <span class="keyword">and</span> self._right_child == <span class="keyword">None</span>:</span><br><span class="line">            tree_str += <span class="string">'LEAF: &#123;&#125;\n'</span>.format(self._leaf_value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tree_str += <span class="string">"Split &#123;&#125; on &#123;&#125;\n"</span>.format(self._best_split_col, self._best_split_value)</span><br><span class="line">            tree_str += str(self._left_child)</span><br><span class="line">            tree_str += str(self._right_child)</span><br><span class="line">        <span class="keyword">return</span> tree_str</span><br><span class="line"></span><br><span class="line"><span class="comment"># load dataset</span></span><br><span class="line">data_set =  pd.read_csv(<span class="string">'iris.data'</span>,  names=[<span class="string">'sepal_length'</span>, <span class="string">'sepal_width'</span>, <span class="string">'petal_length'</span>, <span class="string">'petal_width'</span>, <span class="string">'iris_type'</span>])</span><br><span class="line"><span class="comment"># input comes from STDIN (standard input)</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:</span><br><span class="line">    <span class="comment"># remove leading and trailing whitespace</span></span><br><span class="line">    line = line.strip()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># generate a tree</span></span><br><span class="line">    selected_rows = np.random.choice(data_set.shape[<span class="number">0</span>] - <span class="number">1</span>, data_set.shape[<span class="number">0</span>] / <span class="number">3</span>)</span><br><span class="line">    selected_features = np.random.choice(data_set.columns.tolist()[:<span class="number">-1</span>], np.ceil(np.sqrt(data_set.shape[<span class="number">1</span>])), replace=<span class="keyword">False</span>)</span><br><span class="line">    decision_tree = DecisionNode()</span><br><span class="line">    decision_tree.fit(data_set.iloc[selected_rows,:], selected_features)</span><br><span class="line">    print(<span class="string">'&#123;&#125;'</span>.format(pickle.dumps(decision_tree)))</span><br></pre></td></tr></table></figure>
<h2 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h2><p>Code here is a modified version of reducer in <a href="http://www.michael-noll.com/tutorials/writing-an-hadoop-mapreduce-program-in-python/" target="_blank" rel="noopener">this blog</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/root/anaconda3/bin/python</span></span><br><span class="line"><span class="comment"># Filename: forest_reducer.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># input comes from STDIN</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:</span><br><span class="line">    <span class="comment"># remove leading and trailing whitespace</span></span><br><span class="line">    line = line.strip()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'&#123;&#125;'</span>.format(line))</span><br></pre></td></tr></table></figure>
<h2 id="Test-Mapper-and-Reducer"><a href="#Test-Mapper-and-Reducer" class="headerlink" title="Test Mapper and Reducer"></a>Test Mapper and Reducer</h2><ul>
<li>Generate a forest_number.txt contains <code>n</code> line, where <code>n</code> is the number of trees you want to generate. Because we generate one tree per line, each mapper loads training data (iris) once, and randomly select feature and records for each tree.</li>
<li>If you want to generate 5 trees, forest_number.txt contains</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Make mapper and reducer executable <figure class="highlight plain"><figcaption><span>+x forest_mapper.py forest_reducer.py```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- **Test your mapper and reducer locally** ```cat forest_number.txt | forest_mapper.py | sort | forest_reducer.py  ``` , this step is important because hadoop doesn&apos;t show the exact error output from python, so it&apos;s hard to debug python in hadoop.</span><br><span class="line">- Upload the txt into hdfs under `/demo/data`, using [Ambari file view](http://localhost:8080/#/main/views/FILES/1.0.0/AUTO_FILES_INSTANCE)</span><br><span class="line">- Test mapper and reducer using hadoop</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">hadoop jar /usr/hdp/current/hadoop-mapreduce-client/hadoop-streaming.jar -file /root/forest_mapper.py -mapper forest_mapper.py -file /root/forest_reducer.py -reducer forest_reducer.py -file /root/iris.data -input /demo/data/forest_number.txt -output /demo/outputhadoop jar /usr/hdp/current/hadoop-mapreduce-client/hadoop-streaming.jar -file /root/forest_mapper.py -mapper forest_mapper.py -file /root/forest_reducer.py -reducer forest_reducer.py -file /root/iris.data -input /demo/data/forest_number.txt -output /demo/output</span><br></pre></td></tr></table></figure></p>
</li>
<li><p>After this step, generated trees should be stored in <code>/demo/output</code></p>
</li>
<li>Clean up the output folder after the experiment, this step is important because hadoop will not overwrite existing folder</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -rm -r /demo/output</span><br></pre></td></tr></table></figure>
      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/05/03/SQL-Practice-1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          SQL-Practice-1
        
      </div>
    </a>
  
  
    <a href="/2016/02/22/Secret-Mission-Spy-in-the-Dark/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Secret Mission: Spy in the Dark</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>




<div class="share_addthis">
  <div class="sharing addthis_toolbox share">
    <a class="addthis_button_facebook_like"></a>
    <a class="addthis_button_tweet"></a>
    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-560c64c35486b3d4" async="async"></script>
</div>






<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codemysky'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 Sean Han
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="/js/main.js"></script>
<link rel="stylesheet" href="/css/font-awesome.min.css">





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>